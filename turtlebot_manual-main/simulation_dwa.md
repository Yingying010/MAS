---
Date: 2024-11-24
tags:
  - dwa
  - simulation
---

# 介绍

- 动态窗口算法(Dynamic Window Approaches, DWA) 是基于预测控制理论的一种次优方法，因其在未知环境下能够安全、有效的避开障碍物, 同时具有计算量小, 反应迅速、可操作性强等特点。
- DWA算法属于局部路径规划算法。
- DWA算法的核心思想是根据移动机器人当前的位置状态和速度状态在速度空间 (v,ω) 中确定一个满足移动机器人硬件约束的采样速度空间，然后计算移动机器人在这些速度情况下移动一定时间内的轨迹， 并通过评价函数对该轨迹进行评价，最后选出评价最优的轨迹所对应的速度来作为移动机器人运动速度， 如此循环直至移动机器人到达目标点。
- 对于无人驾驶汽车而言，情况类似，将车辆的位置变化转化为线速度和角速度控制，避障问题转变成空间中的运动约束问题，这样可以通过运动约束条件选择局部最优的路径。

# 算法原理

- DWA算法的思路是：先通过机器人数学模型采集机器人速度样本，并预测模拟出在样本速度下一段时间内生成的运动轨迹， 并对这些运动轨迹进行标准评价， 选择出一组最优轨迹，机器人按照最优轨迹运动。机器人的运动姿态和方向是由机器人当前的线速度及角速度 (转向速度) 共同决定的。

- DWA算法主要包括3个步骤：速度采样、轨迹预测（推算）、轨迹评价。

![[dwa_algorithm.png]]


## 速度采样

由于移动机器人硬件、结构和环境等限制条件，移动机器人的速度采样空间 Vs中(v,ω) 有一定的范围限制。该限制主要分为三大类:
- 速度边界限制
- 加速度限制
- 环境障碍物限制

注意: 这个限制条件在采样初期是得不到的，需要我们先使用V m ∩ V d的速度组合采样模拟出轨迹后, 计算当前速度下对应模拟轨迹与障碍物之间的最近距离, 然后看当前采样的这对速度能否在碰到障碍物之前停下来， 如果能够停下来, 那这对速度就是可接收的。如果不能停下来, 这对速度就得抛弃掉。

我在代码中并没有采用这种做法，而是直接计算机器人当前位置（并不是模拟轨迹）与障碍物的最近距离来得到Va ，算是一种比较投机的做法。

结合上述三类速度限制， 最终的移动机器人速度采样空间是三个速度空间的交集，即
Vs​=Vm​∩Vd​∩Va​

## 轨迹预测

- 在确定速度采样空间 Vs后，DWA算法以一定的采样间距（分辨率）在该空间均匀采样。
- 使用差分驱动移动机器人的运动学模型

## 轨迹评价

确定了机器人约束速度范围后，有一些速度模拟的轨迹是可行的， 但是还有不达标的轨迹， 这需要对采样得到的多组轨迹进行评价择优。通过标准评价轨迹， 比较评分来选出最优轨迹， 然后选取最优轨迹对应的速度作为驱动速度。对每条轨迹进行评估 的评价函数如公式 ( 5 )所示。

`G(v,ω)=σ(α⋅heading(v,ω))+σ(β⋅dist(v,ω))+σ(γ⋅velocity(v,ω))`

heading 是方位角评价函数
dist是距离评价函数
velocity是速度评价函数


# 代码实现

## 初始化小车参数
可以从文档中，或者实际测量中得到
turtlebot3（burger） 
- max_speed = 0.22m/s
- max_yaw_rate = 2.84rad/s
- max_accel = 0.3或者0.5
- max_delta_yaw_rate = 1.0或者2.0
- robot_radius = 0.105m
- dt = 0.1s（TurtleBot控制频率通常为 10 Hz
- predict_time = 2.0 s（适合中低速环境）

```python
class RobotParams:

    def __init__(self):

        self.max_speed = 1.0  # 最大速度 [m/s]

        self.min_speed = -0.5  # 最小速度 [m/s]

        self.max_yaw_rate = 40.0 * np.pi / 180.0  # 最大角速度 [rad/s]

        self.max_accel = 0.2  # 最大加速度 [m/s^2]

        self.max_delta_yaw_rate = 40.0 * np.pi / 180.0  # 最大角速度变化 [rad/s^2]

        self.v_resolution = 0.01  # 速度分辨率 [m/s]

        self.omega_resolution = 0.1 * np.pi / 180.0  # 角速度分辨率 [rad/s]

        self.dt = 0.1  # 时间间隔 [s]

        self.predict_time = 2.0  # 轨迹预测时间 [s]

        self.robot_radius = 0.5  # 小车半径 [m]
```

